var fs = require("fs");
var path = require("path");
var express = require("express");
var expressCfg = require("tt-cfg").expressCfg;


function workDir(router, viewsDir, dir){
    var files = fs.readdirSync(dir);
    for(var i = 0, li = files.length; i < li; ++i){
        var file = files[i]
        var filePath = path.join(dir, file);
        if(fs.statSync(filePath).isDirectory()){
            //workDir(router, viewsDir, filePath);
        }else{
            var extname = path.extname(filePath);
            if(extname && extname.toLowerCase() == ".html"){
                var str = path.basename(file, extname);
                str = path.join(dir, str);
                str = path.relative(viewsDir, str);
                str = str.replace(/\\/g, "/");
                initRoute(router, str);
            }
        }
    }
}

var initRoute = function(router, url){
//    console.log(url);
    router.get("/" + url, function(req, res){
//        console.log("--------->", req.pvlDs);
        res.render(url, {
            title: "EJS example",
            header: "Some users",
            pvlDs : req.pvlDs
        });
    });
}

exports.init = function(router, dir){
    dir = path.join(expressCfg.setOpt.views, dir);
    workDir(router, expressCfg.setOpt.views, dir);
}