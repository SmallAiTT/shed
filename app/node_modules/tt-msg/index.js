var domain = require("domain");
var msgPool = require("./lib/msgPool.js");//获取消息编码
function formatStr(){
    var msg = arguments[0] + "";
    for(var i = 0; i < arguments.length; ++i){
        msg = msg.replace(/\%s/, (arguments[i]+""));
    }
    return msg;
}
exports.embed = function(app){
    app.use(function(req, res, next){
        res.success = function(msgCode){
            var arr = Array.prototype.slice.apply(arguments);
            var msgObj = {type : "info", msg : msgPool.success.msg};
            if(arguments.length > 0){//没有传参则用默认的成功提示信息
                if(typeof msgCode == "string"){
                    var msger = msgPool[msgCode];
                    if(msger){
                        arr[0] = msger.msg;
                    }
                }else if(typeof msgCode == "object" && msgCode.msg){
                    arr[0] = msgCode.msg;
                }
                msgObj.msg = formatStr.apply(null, arr);
            }
            this.json(msgObj);
        }

        res.error = function(msgCode){
            var arr = Array.prototype.slice.apply(arguments);
            var msg = msgPool.error.msg;
            if(arguments.length > 0){//没有传参则用默认的成功提示信息
                if(typeof msgCode == "string"){
                    var msger = msgPool[msgCode];
                    if(msger){
                        arr[0] = msger.msg;
                    }
                }else if(typeof msgCode == "object" && msgCode.msg){
                    arr[0] = msgCode.msg;
                }
                msg = formatStr.apply(null, arr);
            }
            this.json(msg);
//            return new Error(msg);
        };
        next();
    });
}